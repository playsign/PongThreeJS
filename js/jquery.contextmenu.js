!function($){jQuery.fn.contextMenu=function(name,actions,options){var me=this,win=$(window),menu=$('<ul id="'+name+'" class="context-menu"></ul>').hide().appendTo("body"),activeElement=null,hideMenu=function(){$(".context-menu:visible").each(function(){$(this).trigger("closed"),$(this).hide(),$("body").unbind("click",hideMenu),menu.unbind("closed")})},default_options={disable_native_context_menu:!1,leftClick:!1},options=$.extend(default_options,options);if($(document).bind("contextmenu",function(e){options.disable_native_context_menu&&e.preventDefault(),hideMenu()}),$.each(actions,function(me,itemOptions){if(itemOptions.link)var link=itemOptions.link;else var link='<a href="#">'+me+"</a>";var menuItem=$("<li>"+link+"</li>");itemOptions.klass&&menuItem.attr("class",itemOptions.klass),menuItem.appendTo(menu).bind("click",function(e){itemOptions.click(activeElement),e.preventDefault()})}),options.leftClick)var mouseEvent="click";else var mouseEvent="contextmenu";var mouseEventFunc=function(e){hideMenu(),activeElement=$(this),options.showMenu&&options.showMenu.call(menu,activeElement),options.hideMenu&&menu.bind("closed",function(){options.hideMenu.call(menu,activeElement)}),menu.css({visibility:"hidden",position:"absolute",zIndex:1e3});var mWidth=menu.outerWidth(!0),mHeight=menu.outerHeight(!0),xPos=e.pageX-win.scrollLeft()+mWidth<win.width()?e.pageX:e.pageX-mWidth,yPos=e.pageY-win.scrollTop()+mHeight<win.height()?e.pageY:e.pageY-mHeight;return menu.show(0,function(){$("body").bind("click",hideMenu)}).css({visibility:"visible",top:yPos+"px",left:xPos+"px",zIndex:1e3}),!1};return options.delegateEventTo?me.on(mouseEvent,options.delegateEventTo,mouseEventFunc):me.bind(mouseEvent,mouseEventFunc)}}(jQuery);